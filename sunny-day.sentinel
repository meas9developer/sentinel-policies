import "tfplan"

 get_vpc_instances = func() {
     instances = []
         for tfplan.module_paths as path {
                 instances += values(tfplan.module(path).resources.aws_vpc) else []
                     }
                         return instances
                         }

                         # Allowed availability zones
                         allowed_zones = [
                           "0.0.0.0/0",
                         ]

                                     vpcs = get_vpc_instances()

                                     region_allowed = rule {
                                         all vpcs as _, instances {
                                            all instances as index, r {
                                       	   r.applied.cidr_block in allowed_zones
                                            	         }
                                             	             }
                                             	             }

                                                 	             # Main rule that requires other rules to be true
                                                 	             main = rule {
                                                 	               (region_allowed) else true
                                                 	               }
#main = rule { true }
